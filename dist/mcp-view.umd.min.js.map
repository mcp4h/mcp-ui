{
  "version": 3,
  "sources": ["../src/index.ts", "../src/bridge.ts", "../src/iframe-bootstrap.ts", "../src/rewrite.ts", "../src/theme.ts", "../src/mcp-view.ts"],
  "sourcesContent": ["import { McpViewElement, defineMcpView } from \"./mcp-view\";\nexport { McpViewElement, defineMcpView };\nexport type { Resolver, ResolverResult } from \"./mcp-view\";\nif (typeof window !== \"undefined\" && \"customElements\" in window) {\n\tdefineMcpView();\n}\n", "export type ResourceKind = \"document\" | \"style\" | \"script\" | \"img\" | \"media\";\nexport type NormalizedResource = {\n\tok: boolean;\n\tmime: string;\n\tbody: Uint8Array;\n\terror?: string;\n};\nexport async function normalizeResolverResult(result: unknown, kind: ResourceKind, uri: string): Promise<NormalizedResource> {\n\ttry {\n\t\tif (result instanceof Response) {\n\t\t\tif (!result.ok) {\n\t\t\t\treturn {\n\t\t\t\t\tok: false,\n\t\t\t\t\tmime: \"text/plain\",\n\t\t\t\t\tbody: new Uint8Array(),\n\t\t\t\t\terror: `HTTP ${result.status}`\n\t\t\t\t};\n\t\t\t}\n\t\t\tconst body = new Uint8Array(await result.arrayBuffer());\n\t\t\tconst mime = result.headers.get(\"content-type\") || inferMime(kind, uri);\n\t\t\treturn { ok: true, mime, body };\n\t\t}\n\t\tif (result instanceof Blob) {\n\t\t\tconst body = new Uint8Array(await result.arrayBuffer());\n\t\t\tconst mime = result.type || inferMime(kind, uri);\n\t\t\treturn { ok: true, mime, body };\n\t\t}\n\t\tif (typeof result === \"string\") {\n\t\t\tconst encoder = new TextEncoder();\n\t\t\tconst body = encoder.encode(result);\n\t\t\tconst mime = inferMime(kind, uri);\n\t\t\treturn { ok: true, mime, body };\n\t\t}\n\t\tif (result instanceof ArrayBuffer) {\n\t\t\tconst body = new Uint8Array(result);\n\t\t\tconst mime = inferMime(kind, uri);\n\t\t\treturn { ok: true, mime, body };\n\t\t}\n\t\tif (result instanceof Uint8Array) {\n\t\t\tconst mime = inferMime(kind, uri);\n\t\t\treturn { ok: true, mime, body: result };\n\t\t}\n\t}\n\tcatch (error) {\n\t\treturn {\n\t\t\tok: false,\n\t\t\tmime: \"text/plain\",\n\t\t\tbody: new Uint8Array(),\n\t\t\terror: error instanceof Error ? error.message : \"Unknown error\"\n\t\t};\n\t}\n\treturn {\n\t\tok: false,\n\t\tmime: \"text/plain\",\n\t\tbody: new Uint8Array(),\n\t\terror: \"Unsupported resolver result\"\n\t};\n}\nexport function inferMime(kind: ResourceKind, uri: string): string {\n\tif (kind === \"document\") return \"text/html\";\n\tif (kind === \"style\") return \"text/css\";\n\tif (kind === \"script\") return \"text/javascript\";\n\tconst ext = getExtension(uri);\n\tif (ext) {\n\t\tconst lookup: Record<string, string> = {\n\t\t\tcss: \"text/css\",\n\t\t\tjs: \"text/javascript\",\n\t\t\tmjs: \"text/javascript\",\n\t\t\tcjs: \"text/javascript\",\n\t\t\tjson: \"application/json\",\n\t\t\tsvg: \"image/svg+xml\",\n\t\t\tpng: \"image/png\",\n\t\t\tjpg: \"image/jpeg\",\n\t\t\tjpeg: \"image/jpeg\",\n\t\t\tgif: \"image/gif\",\n\t\t\twebp: \"image/webp\",\n\t\t\tavif: \"image/avif\",\n\t\t\twoff: \"font/woff\",\n\t\t\twoff2: \"font/woff2\",\n\t\t\tttf: \"font/ttf\",\n\t\t\totf: \"font/otf\",\n\t\t\tmp3: \"audio/mpeg\",\n\t\t\twav: \"audio/wav\",\n\t\t\tmp4: \"video/mp4\",\n\t\t\twebm: \"video/webm\"\n\t\t};\n\t\tif (lookup[ext]) return lookup[ext];\n\t}\n\tif (kind === \"img\") return \"image/png\";\n\treturn \"application/octet-stream\";\n}\nfunction getExtension(uri: string): string | null {\n\ttry {\n\t\tconst url = new URL(uri);\n\t\tconst path = url.pathname;\n\t\tconst last = path.split(\"/\").pop();\n\t\tif (!last || !last.includes(\".\")) return null;\n\t\treturn last.split(\".\").pop()?.toLowerCase() || null;\n\t}\n\tcatch {\n\t\treturn null;\n\t}\n}\n", "export function getIframeBootstrapScript(initialData: unknown): string {\n\tconst serialized = safeSerialize(initialData);\n\treturn `(() => {\n  const initialData = ${serialized};\n  window.mcpData = initialData;\n  const pending = new Map();\n  const toolPending = new Map();\n  let nextId = 1;\n  let nextToolId = 1;\n  const decoder = new TextDecoder();\n  const deferredScripts = [];\n  let deferredReady = document.readyState !== \"loading\";\n  let deferredListenerAttached = false;\n\n  function sanitizeLayerName(name) {\n    if (!name) return null;\n    const trimmed = String(name).trim();\n    if (!trimmed) return null;\n    if (!/^[a-zA-Z0-9_-]+$/.test(trimmed)) return null;\n    return trimmed;\n  }\n\n  function requestResource(uri, kind) {\n    return new Promise((resolve) => {\n      const id = nextId++;\n      pending.set(id, resolve);\n      window.parent.postMessage({ type: \"mcp:request\", id, uri, kind }, \"*\");\n    });\n  }\n\n  function enqueueDeferredScript(run) {\n    if (!deferredReady && document.readyState !== \"loading\") {\n      deferredReady = true;\n    }\n    deferredScripts.push(run);\n    if (!deferredReady && !deferredListenerAttached) {\n      deferredListenerAttached = true;\n      document.addEventListener(\n        \"DOMContentLoaded\",\n        () => {\n          deferredReady = true;\n          flushDeferredScripts();\n        },\n        { once: true }\n      );\n    }\n    if (deferredReady) {\n      flushDeferredScripts();\n    }\n  }\n\n  function flushDeferredScripts() {\n    while (deferredScripts.length) {\n      const run = deferredScripts.shift();\n      if (typeof run === \"function\") run();\n    }\n  }\n\n  function callTool(params) {\n    return new Promise((resolve, reject) => {\n      const id = nextToolId++;\n      toolPending.set(id, { resolve, reject });\n      window.parent.postMessage({ type: \"mcp:tool-call\", id, params }, \"*\");\n    });\n  }\n\n  window.addEventListener(\"message\", (event) => {\n    if (event.source !== window.parent) return;\n    const data = event.data;\n    if (!data) return;\n    if (data.type === \"mcp:response\") {\n      const resolve = pending.get(data.id);\n      if (!resolve) return;\n      pending.delete(data.id);\n      resolve(data);\n      return;\n    }\n    if (data.type === \"mcp:tool-result\") {\n      const entry = toolPending.get(data.id);\n      if (!entry) return;\n      toolPending.delete(data.id);\n      if (data.ok) {\n        entry.resolve(data.result);\n      } else {\n        const message = data.error || \"Tool call failed\";\n        entry.reject(new Error(message));\n      }\n      return;\n    }\n    if (data.type === \"mcp-data:update\") {\n      window.mcpData = data.payload;\n      window.dispatchEvent(new CustomEvent(\"mcp-data\", { detail: data.payload }));\n    }\n  });\n\n  window.mcp = window.mcp || {};\n  window.mcp.callTool = callTool;\n\n  function toText(body) {\n    const buffer = body || new ArrayBuffer(0);\n    return decoder.decode(new Uint8Array(buffer));\n  }\n\n  function toBlobUrl(body, mime) {\n    const buffer = body || new ArrayBuffer(0);\n    const blob = new Blob([buffer], { type: mime || \"application/octet-stream\" });\n    return URL.createObjectURL(blob);\n  }\n\n  function copyAttributes(from, to, skip) {\n    const skipSet = new Set(skip || []);\n    for (const attr of Array.from(from.attributes)) {\n      if (skipSet.has(attr.name)) continue;\n      to.setAttribute(attr.name, attr.value);\n    }\n  }\n\n  class McpLink extends HTMLElement {\n    connectedCallback() {\n      if (this.hasAttribute(\"data-mcp-blocked\")) return;\n      const href = this.getAttribute(\"href\");\n      if (!href) return;\n      const rel = (this.getAttribute(\"rel\") || \"\").toLowerCase();\n      if (rel && rel !== \"stylesheet\") return;\n      requestResource(href, \"style\").then((res) => {\n        if (!res || !res.ok) return;\n        const style = document.createElement(\"style\");\n        const media = this.getAttribute(\"media\");\n        if (media) style.setAttribute(\"media\", media);\n        const layer = sanitizeLayerName(this.getAttribute(\"layer\")) || \"mcp-content\";\n        style.textContent = \"@layer \" + layer + \" {\\\\n\" + toText(res.body) + \"\\\\n}\";\n        if (this.hasAttribute(\"data-mcp-head\")) {\n          (document.head || document.documentElement).appendChild(style);\n          this.remove();\n          return;\n        }\n        this.replaceWith(style);\n      });\n    }\n  }\n\n  class McpScript extends HTMLElement {\n    connectedCallback() {\n      if (this.hasAttribute(\"data-mcp-blocked\")) {\n        console.error(\"[mcp] script blocked\", this.getAttribute(\"src\"));\n        return;\n      }\n      const src = this.getAttribute(\"src\");\n      if (!src) {\n        console.error(\"[mcp] script missing src\", this);\n        return;\n      }\n      const isDefer = this.hasAttribute(\"defer\");\n      requestResource(src, \"script\").then((res) => {\n        if (!res || !res.ok) {\n          console.error(\"[mcp] script resolve failed\", src, res?.error || \"unknown\");\n          return;\n        }\n        const script = document.createElement(\"script\");\n        const type = this.getAttribute(\"type\");\n        if (type) script.setAttribute(\"type\", type);\n        script.textContent = toText(res.body);\n        console.debug(\"[mcp] script injected\", src);\n        const placeScript = () => {\n          if (this.hasAttribute(\"data-mcp-head\")) {\n            (document.head || document.documentElement).appendChild(script);\n            this.remove();\n            return;\n          }\n          this.replaceWith(script);\n        };\n        if (isDefer) {\n          enqueueDeferredScript(placeScript);\n          return;\n        }\n        placeScript();\n      });\n    }\n  }\n\n  class McpImg extends HTMLElement {\n    connectedCallback() {\n      if (this.hasAttribute(\"data-mcp-blocked\")) return;\n      const src = this.getAttribute(\"src\");\n      if (!src) return;\n      requestResource(src, \"img\").then((res) => {\n        if (!res || !res.ok) return;\n        const img = document.createElement(\"img\");\n        copyAttributes(this, img, [\"src\"]);\n        const url = toBlobUrl(res.body, res.mime);\n        img.addEventListener(\"load\", () => URL.revokeObjectURL(url), { once: true });\n        img.addEventListener(\"error\", () => URL.revokeObjectURL(url), { once: true });\n        img.setAttribute(\"src\", url);\n        this.replaceWith(img);\n      });\n    }\n  }\n\n  class McpMedia extends HTMLElement {\n    connectedCallback() {\n      if (this.hasAttribute(\"data-mcp-blocked\")) return;\n      const src = this.getAttribute(\"src\");\n      if (!src) return;\n      const tag = this.tagName.toLowerCase().replace(\"mcp-\", \"\");\n      requestResource(src, \"media\").then((res) => {\n        if (!res || !res.ok) return;\n        const node = document.createElement(tag);\n        copyAttributes(this, node, [\"src\"]);\n        const url = toBlobUrl(res.body, res.mime);\n        if (tag === \"source\") {\n          node.setAttribute(\"src\", url);\n        } else {\n          node.setAttribute(\"src\", url);\n          node.addEventListener(\"loadeddata\", () => URL.revokeObjectURL(url), { once: true });\n          node.addEventListener(\"error\", () => URL.revokeObjectURL(url), { once: true });\n        }\n        this.replaceWith(node);\n      });\n    }\n  }\n\n  class McpAudio extends McpMedia {}\n  class McpVideo extends McpMedia {}\n  class McpSource extends McpMedia {}\n\n  customElements.define(\"mcp-link\", McpLink);\n  customElements.define(\"mcp-script\", McpScript);\n  customElements.define(\"mcp-img\", McpImg);\n  customElements.define(\"mcp-audio\", McpAudio);\n  customElements.define(\"mcp-video\", McpVideo);\n  customElements.define(\"mcp-source\", McpSource);\n})();`;\n}\nfunction sanitizeLayerName(name: string | null): string | null {\n\tif (!name) return null;\n\tconst trimmed = name.trim();\n\tif (!trimmed) return null;\n\tif (!/^[a-zA-Z0-9_-]+$/.test(trimmed)) return null;\n\treturn trimmed;\n}\nfunction safeSerialize(value: unknown): string {\n\ttry {\n\t\treturn JSON.stringify(value ?? null)\n\t\t\t.replace(/</g, \"\\\\u003c\")\n\t\t\t.replace(/>/g, \"\\\\u003e\")\n\t\t\t.replace(/\\u2028/g, \"\\\\u2028\")\n\t\t\t.replace(/\\u2029/g, \"\\\\u2029\");\n\t}\n\tcatch {\n\t\treturn \"null\";\n\t}\n}\n", "type RewriteOptions = {\n\thtml: string;\n\trootUri?: string | null;\n\tthemeCss: string;\n\tthemeLink?: string | null;\n\tbootstrapScript: string;\n\tallowRemote: (url: string) => boolean;\n};\nconst BLOCKED_ATTR = \"data-mcp-blocked\";\nexport function rewriteHtml(options: RewriteOptions): string {\n\tconst parser = new DOMParser();\n\tconst doc = parser.parseFromString(options.html, \"text/html\");\n\taddRootClass(doc.documentElement, \"mcp-root\");\n\tif (doc.body) addRootClass(doc.body, \"mcp-root\");\n\trewriteElement(doc, \"link\", \"href\", \"mcp-link\", options);\n\trewriteElement(doc, \"script\", \"src\", \"mcp-script\", options);\n\trewriteElement(doc, \"img\", \"src\", \"mcp-img\", options);\n\trewriteElement(doc, \"source\", \"src\", \"mcp-source\", options);\n\trewriteElement(doc, \"audio\", \"src\", \"mcp-audio\", options);\n\trewriteElement(doc, \"video\", \"src\", \"mcp-video\", options);\n\tconst head = ensureHead(doc);\n\tconst themeStyle = doc.createElement(\"style\");\n\tthemeStyle.setAttribute(\"data-mcp\", \"theme\");\n\tthemeStyle.textContent = options.themeCss;\n\thead.insertBefore(themeStyle, head.firstChild);\n\tlet bootstrapAnchor: ChildNode | null = themeStyle.nextSibling;\n\tif (options.themeLink) {\n\t\tconst linkNode = buildThemeLink(doc, options.themeLink, options);\n\t\tif (linkNode) {\n\t\t\thead.insertBefore(linkNode, themeStyle.nextSibling);\n\t\t\tbootstrapAnchor = linkNode.nextSibling;\n\t\t}\n\t}\n\tconst bootstrap = doc.createElement(\"script\");\n\tbootstrap.setAttribute(\"data-mcp\", \"bootstrap\");\n\tbootstrap.textContent = options.bootstrapScript;\n\thead.insertBefore(bootstrap, bootstrapAnchor);\n\tconst doctype = doc.doctype ? `<!doctype ${doc.doctype.name}>` : \"<!doctype html>\";\n\treturn `${doctype}\\n${doc.documentElement.outerHTML}`;\n}\nfunction rewriteElement(doc: Document, tagName: string, attrName: string, replacementTag: string, options: RewriteOptions): void {\n\tconst elements = Array.from(doc.getElementsByTagName(tagName));\n\tfor (const el of elements) {\n\t\tconst raw = el.getAttribute(attrName);\n\t\tif (!raw) continue;\n\t\tconst info = resolveUrl(raw, options.rootUri || undefined);\n\t\tif (!info) continue;\n\t\tif (info.scheme !== \"ui\" && info.scheme !== \"http\" && info.scheme !== \"https\") {\n\t\t\tcontinue;\n\t\t}\n\t\tconst replacement = doc.createElement(replacementTag);\n\t\tcopyAttributes(el, replacement);\n\t\treplacement.setAttribute(attrName, info.url);\n\t\tif (el.ownerDocument?.head && el.ownerDocument.head.contains(el)) {\n\t\t\treplacement.setAttribute(\"data-mcp-head\", \"true\");\n\t\t}\n\t\tif (info.scheme === \"http\" || info.scheme === \"https\") {\n\t\t\tif (!options.allowRemote(info.url)) {\n\t\t\t\treplacement.setAttribute(BLOCKED_ATTR, \"true\");\n\t\t\t}\n\t\t}\n\t\tel.replaceWith(replacement);\n\t}\n}\nfunction resolveUrl(raw: string, base?: string): { url: string; scheme: string } | null {\n\tconst value = raw.trim();\n\tif (!value) return null;\n\tif (value.startsWith(\"#\")) return null;\n\tconst schemeMatch = value.match(/^[a-zA-Z][a-zA-Z0-9+.-]*:/);\n\tif (schemeMatch) {\n\t\tconst scheme = schemeMatch[0].slice(0, -1).toLowerCase();\n\t\tif (isIgnoredScheme(scheme)) return null;\n\t\treturn { url: value, scheme };\n\t}\n\tif (!base) return null;\n\ttry {\n\t\tconst resolved = new URL(value, base).toString();\n\t\tconst scheme = new URL(resolved).protocol.replace(\":\", \"\").toLowerCase();\n\t\tif (isIgnoredScheme(scheme)) return null;\n\t\treturn { url: resolved, scheme };\n\t}\n\tcatch {\n\t\treturn null;\n\t}\n}\nfunction isIgnoredScheme(scheme: string): boolean {\n\treturn [\"data\", \"blob\", \"mailto\", \"tel\", \"javascript\", \"about\"].includes(scheme);\n}\nfunction copyAttributes(from: Element, to: Element): void {\n\tfor (const attr of Array.from(from.attributes)) {\n\t\tto.setAttribute(attr.name, attr.value);\n\t}\n}\nfunction addRootClass(el: Element | null, className: string): void {\n\tif (!el) return;\n\tconst existing = el.getAttribute(\"class\");\n\tif (!existing) {\n\t\tel.setAttribute(\"class\", className);\n\t\treturn;\n\t}\n\tconst classes = new Set(existing.split(/\\s+/).filter(Boolean));\n\tclasses.add(className);\n\tel.setAttribute(\"class\", Array.from(classes).join(\" \"));\n}\nfunction ensureHead(doc: Document): HTMLHeadElement {\n\tif (doc.head) return doc.head;\n\tconst head = doc.createElement(\"head\");\n\tconst html = doc.documentElement;\n\tif (html.firstChild) {\n\t\thtml.insertBefore(head, html.firstChild);\n\t}\n\telse {\n\t\thtml.appendChild(head);\n\t}\n\treturn head;\n}\nfunction buildThemeLink(doc: Document, url: string, options: RewriteOptions): HTMLElement | null {\n\tconst trimmed = url.trim();\n\tconst info = trimmed.startsWith(\"ui://\") ? resolveUrl(trimmed, options.rootUri || undefined) : resolveUrlWithWindow(trimmed);\n\tif (!info) return null;\n\tif (info.scheme === \"ui\") {\n\t\tconst node = doc.createElement(\"mcp-link\");\n\t\tnode.setAttribute(\"rel\", \"stylesheet\");\n\t\tnode.setAttribute(\"href\", info.url);\n\t\tnode.setAttribute(\"layer\", \"mcp-user\");\n\t\treturn node;\n\t}\n\tif (info.scheme === \"http\" || info.scheme === \"https\") {\n\t\tconst node = doc.createElement(\"link\");\n\t\tnode.setAttribute(\"rel\", \"stylesheet\");\n\t\tnode.setAttribute(\"href\", info.url);\n\t\tnode.setAttribute(\"layer\", \"mcp-user\");\n\t\treturn node;\n\t}\n\treturn null;\n}\nfunction resolveUrlWithWindow(raw: string): { url: string; scheme: string } | null {\n\tif (typeof window === \"undefined\" || !window.location) return null;\n\ttry {\n\t\tconst resolved = new URL(raw, window.location.href).toString();\n\t\tconst scheme = new URL(resolved).protocol.replace(\":\", \"\").toLowerCase();\n\t\tif (isIgnoredScheme(scheme)) return null;\n\t\treturn { url: resolved, scheme };\n\t}\n\tcatch {\n\t\treturn null;\n\t}\n}\n", "export type CssInput = string | Record<string, string>;\nexport type ThemeInputs = { css?: CssInput | null; layers?: string[] | null };\nconst DEFAULT_LAYERS = [\"mcp-default\", \"mcp-content\", \"mcp-user\"];\nconst defaultVariables: Record<string, string> = {\n\t\"--mcp-color-bg\": \"#f7f7f5\",\n\t\"--mcp-color-fg\": \"#1f1f1b\",\n\t\"--mcp-color-muted\": \"#e7e6e2\",\n\t\"--mcp-color-muted-fg\": \"#4b4a44\",\n\t\"--mcp-color-border\": \"#d1d0ca\",\n\t\"--mcp-color-border-strong\": \"#b5b3ab\",\n\t\"--mcp-surface\": \"#ffffff\",\n\t\"--mcp-surface-alt\": \"#f0f0ec\",\n\t\"--mcp-color-primary\": \"#3b5ccc\",\n\t\"--mcp-color-primary-fg\": \"#f8f9ff\",\n\t\"--mcp-color-secondary\": \"#5b6478\",\n\t\"--mcp-color-secondary-fg\": \"#f5f7fb\",\n\t\"--mcp-color-accent\": \"#2f7f6b\",\n\t\"--mcp-color-accent-fg\": \"#f1fffb\",\n\t\"--mcp-color-success\": \"#2f7f6b\",\n\t\"--mcp-color-success-fg\": \"#f1fffb\",\n\t\"--mcp-color-warning\": \"#b26a1f\",\n\t\"--mcp-color-warning-fg\": \"#fff6ea\",\n\t\"--mcp-color-danger\": \"#b3343a\",\n\t\"--mcp-color-danger-fg\": \"#fff1f2\",\n\t\"--mcp-syntax-comment\": \"color-mix(in srgb, var(--mcp-color-muted-fg) 75%, var(--mcp-color-fg))\",\n\t\"--mcp-syntax-constant\": \"color-mix(in srgb, var(--mcp-color-accent) 70%, var(--mcp-color-fg))\",\n\t\"--mcp-syntax-keyword\": \"color-mix(in srgb, var(--mcp-color-primary) 75%, var(--mcp-color-fg))\",\n\t\"--mcp-syntax-entity\": \"color-mix(in srgb, var(--mcp-color-secondary) 70%, var(--mcp-color-fg))\",\n\t\"--mcp-syntax-tag\": \"color-mix(in srgb, var(--mcp-color-accent) 75%, var(--mcp-color-fg))\",\n\t\"--mcp-syntax-variable\": \"color-mix(in srgb, var(--mcp-color-fg) 85%, var(--mcp-color-muted-fg))\",\n\t\"--mcp-syntax-string\": \"color-mix(in srgb, var(--mcp-color-success) 75%, var(--mcp-color-fg))\",\n\t\"--mcp-syntax-number\": \"color-mix(in srgb, var(--mcp-color-warning) 75%, var(--mcp-color-fg))\",\n\t\"--mcp-syntax-operator\": \"color-mix(in srgb, var(--mcp-color-fg) 80%, var(--mcp-color-muted-fg))\",\n\t\"--mcp-syntax-punctuation\": \"color-mix(in srgb, var(--mcp-color-fg) 70%, var(--mcp-color-muted-fg))\",\n\t\"--mcp-font-sans\": '\"IBM Plex Sans\", \"Source Sans 3\", \"Assistant\", \"Noto Sans\", \"Apple Color ' + 'Emoji\", \"Segoe UI Emoji\", \"Noto Color Emoji\", sans-serif',\n\t\"--mcp-font-serif\": '\"IBM Plex Serif\", \"Source Serif 4\", \"Noto Serif\", serif',\n\t\"--mcp-font-mono\": '\"IBM Plex Mono\", \"Source Code Pro\", \"Fira Mono\", monospace',\n\t\"--mcp-text-2xs\": \"0.625rem\",\n\t\"--mcp-text-xs\": \"0.75rem\",\n\t\"--mcp-text-s\": \"0.875rem\",\n\t\"--mcp-text-m\": \"1rem\",\n\t\"--mcp-text-l\": \"1.125rem\",\n\t\"--mcp-text-xl\": \"1.25rem\",\n\t\"--mcp-text-2xl\": \"1.5rem\",\n\t\"--mcp-leading-tight\": \"1.2\",\n\t\"--mcp-leading-normal\": \"1.5\",\n\t\"--mcp-leading-relaxed\": \"1.75\",\n\t\"--mcp-weight-regular\": \"400\",\n\t\"--mcp-weight-medium\": \"500\",\n\t\"--mcp-weight-bold\": \"700\",\n\t\"--mcp-space-3xs\": \"0.125rem\",\n\t\"--mcp-space-2xs\": \"0.25rem\",\n\t\"--mcp-space-xs\": \"0.375rem\",\n\t\"--mcp-space-s\": \"0.5rem\",\n\t\"--mcp-space-m\": \"0.75rem\",\n\t\"--mcp-space-l\": \"1rem\",\n\t\"--mcp-space-xl\": \"1.5rem\",\n\t\"--mcp-space-2xl\": \"2rem\",\n\t\"--mcp-radius-0\": \"0\",\n\t\"--mcp-radius-xs\": \"0.125rem\",\n\t\"--mcp-radius-s\": \"0.25rem\",\n\t\"--mcp-radius-m\": \"0.5rem\",\n\t\"--mcp-radius-l\": \"0.75rem\",\n\t\"--mcp-radius-xl\": \"1rem\",\n\t\"--mcp-radius-round\": \"9999px\",\n\t\"--mcp-shadow-none\": \"none\",\n\t\"--mcp-shadow-xs\": \"0 1px 2px rgba(0, 0, 0, 0.08)\",\n\t\"--mcp-shadow-s\": \"0 2px 6px rgba(0, 0, 0, 0.12)\",\n\t\"--mcp-shadow-m\": \"0 6px 16px rgba(0, 0, 0, 0.16)\",\n\t\"--mcp-shadow-l\": \"0 12px 32px rgba(0, 0, 0, 0.2)\",\n\t\"--mcp-layer-0\": \"0\",\n\t\"--mcp-layer-1\": \"10\",\n\t\"--mcp-layer-2\": \"20\",\n\t\"--mcp-layer-3\": \"30\",\n\t\"--mcp-layer-4\": \"40\",\n\t\"--mcp-duration-instant\": \"0ms\",\n\t\"--mcp-duration-fast\": \"120ms\",\n\t\"--mcp-duration-normal\": \"200ms\",\n\t\"--mcp-duration-slow\": \"320ms\",\n\t\"--mcp-ease-standard\": \"cubic-bezier(0.2, 0, 0, 1)\",\n\t\"--mcp-ease-emphasized\": \"cubic-bezier(0.2, 0, 0, 1.4)\",\n\t\"--mcp-ring\": \"0 0 0 2px\",\n\t\"--mcp-ring-color\": \"rgba(59, 92, 204, 0.2)\"\n};\nconst utilityCss = [\".mcp-root{\", `  ${serializeVariables(defaultVariables)}`, \"  color: var(--mcp-color-fg);\", \"  background: var(--mcp-color-bg);\", \"  font-family: var(--mcp-font-sans);\", \"  font-size: var(--mcp-text-m);\", \"  line-height: var(--mcp-leading-normal);\", \"  font-weight: var(--mcp-weight-regular);\", \"  margin: 0;\", \"}\", \".mcp-button{\", \"  display: inline-flex;\", \"  align-items: center;\", \"  justify-content: center;\", \"  gap: var(--mcp-space-2xs);\", \"  padding: var(--mcp-space-xs) var(--mcp-space-m);\", \"  border: 1px solid var(--mcp-color-border);\", \"  border-radius: var(--mcp-radius-m);\", \"  background: var(--mcp-color-bg);\", \"  color: var(--mcp-color-fg);\", \"  font-size: var(--mcp-text-s);\", \"  line-height: var(--mcp-leading-normal);\", \"  text-decoration: none;\", \"  cursor: pointer;\", \"  transition: background var(--mcp-duration-fast) var(--mcp-ease-standard), border-color \" + \"var(--mcp-duration-fast) var(--mcp-ease-standard), transform var(--mcp-duration-fast) \" + \"var(--mcp-ease-standard);\", \"}\", \".mcp-button:where(:hover){\", \"  background: var(--mcp-color-muted);\", \"}\", \".mcp-button:where(:active){\", \"  transform: translateY(1px);\", \"}\", \".mcp-button:where(.active, [aria-pressed='true']){\", \"  filter: brightness(0.98);\", \"}\", \".mcp-button-primary{\", \"  background: var(--mcp-color-primary);\", \"  color: var(--mcp-color-primary-fg);\", \"  border-color: var(--mcp-color-primary);\", \"}\", \".mcp-button-primary:where(:hover){\", \"  filter: brightness(0.98);\", \"}\", \".mcp-button-secondary{\", \"  background: var(--mcp-color-secondary);\", \"  color: var(--mcp-color-secondary-fg);\", \"  border-color: var(--mcp-color-secondary);\", \"}\", \".mcp-button-ghost{\", \"  background: transparent;\", \"  border-color: transparent;\", \"}\", \".mcp-button-danger{\", \"  background: var(--mcp-color-danger);\", \"  color: var(--mcp-color-danger-fg);\", \"  border-color: var(--mcp-color-danger);\", \"}\", \".mcp-toolbar{\", \"  display: inline-flex;\", \"  align-items: center;\", \"  border: 1px solid var(--mcp-color-border);\", \"  border-radius: var(--mcp-radius-m);\", \"}\", \".mcp-toolbar .mcp-button{\", \"  border: 0;\", \"  border-radius: 0;\", \"}\", \".mcp-toolbar .mcp-button + .mcp-button{\", \"  border-left: 1px solid var(--mcp-color-border);\", \"}\", \".mcp-toolbar .mcp-button:first-child{\", \"  border-top-left-radius: var(--mcp-radius-m);\", \"  border-bottom-left-radius: var(--mcp-radius-m);\", \"}\", \".mcp-toolbar .mcp-button:last-child{\", \"  border-top-right-radius: var(--mcp-radius-m);\", \"  border-bottom-right-radius: var(--mcp-radius-m);\", \"}\", \".mcp-toolbar .mcp-button:where(.active, [aria-pressed='true']){\", \"  position: relative;\", \"  z-index: 1;\", \"}\", \".mcp-input, .mcp-textarea, .mcp-select{\", \"  width: 100%;\", \"  padding: var(--mcp-space-xs) var(--mcp-space-s);\", \"  border: 1px solid var(--mcp-color-border);\", \"  border-radius: var(--mcp-radius-s);\", \"  background: var(--mcp-color-bg);\", \"  color: var(--mcp-color-fg);\", \"  font-size: var(--mcp-text-s);\", \"  line-height: var(--mcp-leading-normal);\", \"}\", \".mcp-input:where(:focus), .mcp-textarea:where(:focus), .mcp-select:where(:focus){\", \"  outline: none;\", \"  border-color: var(--mcp-color-primary);\", \"  box-shadow: var(--mcp-ring) var(--mcp-ring-color);\", \"}\", \".mcp-label{\", \"  display: block;\", \"  margin-bottom: var(--mcp-space-3xs);\", \"  font-size: var(--mcp-text-xs);\", \"  color: var(--mcp-color-muted-fg);\", \"}\", \".mcp-card{\", \"  background: var(--mcp-surface);\", \"  border: 1px solid var(--mcp-color-border);\", \"  border-radius: var(--mcp-radius-l);\", \"  padding: var(--mcp-space-l);\", \"  box-shadow: var(--mcp-shadow-xs);\", \"}\", \".mcp-panel{\", \"  background: var(--mcp-surface);\", \"  border: 1px solid var(--mcp-color-border);\", \"  border-radius: var(--mcp-radius-l);\", \"  padding: var(--mcp-space-l);\", \"  box-shadow: var(--mcp-shadow-xs);\", \"}\", \".mcp-field{\", \"  display: flex;\", \"  flex-direction: column;\", \"  gap: var(--mcp-space-3xs);\", \"}\", \".mcp-divider{\", \"  height: 1px;\", \"  background: var(--mcp-color-border);\", \"  border: 0;\", \"}\", \".mcp-surface{\", \"  background: var(--mcp-color-muted);\", \"  border-radius: var(--mcp-radius-m);\", \"  padding: var(--mcp-space-m);\", \"}\", \".mcp-badge{\", \"  display: inline-flex;\", \"  align-items: center;\", \"  padding: 0 var(--mcp-space-xs);\", \"  border-radius: var(--mcp-radius-round);\", \"  background: var(--mcp-color-secondary);\", \"  color: var(--mcp-color-secondary-fg);\", \"  font-size: var(--mcp-text-2xs);\", \"  line-height: 1.6;\", \"}\", \".mcp-tag{\", \"  display: inline-flex;\", \"  align-items: center;\", \"  padding: 0 var(--mcp-space-xs);\", \"  border-radius: var(--mcp-radius-s);\", \"  background: var(--mcp-color-muted);\", \"  color: var(--mcp-color-muted-fg);\", \"  font-size: var(--mcp-text-2xs);\", \"  line-height: 1.6;\", \"}\", \".mcp-divider{\", \"  height: 1px;\", \"  background: var(--mcp-color-border);\", \"}\", \".mcp-text-muted{\", \"  color: var(--mcp-color-muted-fg);\", \"}\", \".mcp-title{\", \"  font-size: var(--mcp-text-xl);\", \"  line-height: var(--mcp-leading-tight);\", \"  font-weight: var(--mcp-weight-bold);\", \"}\", \".mcp-subtitle{\", \"  font-size: var(--mcp-text-l);\", \"  line-height: var(--mcp-leading-normal);\", \"  font-weight: var(--mcp-weight-medium);\", \"  color: var(--mcp-color-muted-fg);\", \"}\"].join(\"\\n\");\nexport function buildThemeCss(inputs: ThemeInputs): string {\n\tconst parts: string[] = [];\n\tconst order = buildLayerOrder(inputs.layers);\n\tparts.push(`@layer ${order.join(\", \")};`);\n\tparts.push(wrapLayer(\"mcp-default\", utilityCss));\n\tconst overrides = normalizeCssInput(inputs.css);\n\tif (overrides) {\n\t\tparts.push(wrapLayer(\"mcp-user\", overrides));\n\t}\n\treturn parts.join(\"\\n\\n\");\n}\nfunction buildLayerOrder(layers?: string[] | null): string[] {\n\tconst order: string[] = [];\n\tif (layers && layers.length > 0) {\n\t\tfor (const layer of layers) {\n\t\t\tconst trimmed = layer.trim();\n\t\t\tif (!trimmed) continue;\n\t\t\tif (!order.includes(trimmed)) order.push(trimmed);\n\t\t}\n\t}\n\tfor (let i = DEFAULT_LAYERS.length - 1; i >= 0; i -= 1) {\n\t\tconst layer = DEFAULT_LAYERS[i];\n\t\tif (!order.includes(layer)) order.unshift(layer);\n\t}\n\treturn order;\n}\nfunction wrapLayer(name: string, css: string): string {\n\treturn `@layer ${name} {\\n${css}\\n}`;\n}\nfunction serializeVariables(vars: Record<string, string>): string {\n\treturn Object.entries(vars).map(([key, value]) => `${key}: ${value};`).join(\"\\n  \");\n}\nfunction normalizeCssInput(input?: CssInput | null): string | null {\n\tif (!input) return null;\n\tconst value = input;\n\tif (!value) return null;\n\tif (typeof value === \"string\") return value;\n\tif (typeof value === \"object\") {\n\t\tconst filtered = filterVariables(value);\n\t\tif (Object.keys(filtered).length === 0) return null;\n\t\treturn `.mcp-root{${serializeVariables(filtered)}}`;\n\t}\n\treturn null;\n}\nfunction filterVariables(vars: Record<string, string>): Record<string, string> {\n\tconst filtered: Record<string, string> = {};\n\tfor (const [key, value] of Object.entries(vars)) {\n\t\tif (key.startsWith(\"--mcp-\")) {\n\t\t\tfiltered[key] = value;\n\t\t}\n\t}\n\treturn filtered;\n}\n", "import { normalizeResolverResult, inferMime, type ResourceKind } from \"./bridge\";\nimport { getIframeBootstrapScript } from \"./iframe-bootstrap\";\nimport { rewriteHtml } from \"./rewrite\";\nimport { buildThemeCss, type CssInput } from \"./theme\";\nexport type ResolverResult = Response | Blob | string | ArrayBuffer | Uint8Array;\nexport type Resolver = (uri: string) => Promise<ResolverResult>;\nexport type ToolCaller = (params: unknown) => Promise<unknown>;\ntype PendingRequest = {\n\tid: number;\n\turi: string;\n\tkind: ResourceKind;\n\tsource: MessageEventSource | null;\n};\ntype PendingToolCall = {\n\tid: number;\n\tparams: unknown;\n\tsource: MessageEventSource | null;\n};\ntype ResolveResult = {\n\tok: boolean;\n\tmime: string;\n\tbody: Uint8Array;\n\terror?: string;\n};\ntype ToolResult = {\n\tok: boolean;\n\tresult?: unknown;\n\terror?: string;\n};\nexport class McpViewElement extends HTMLElement {\n\tstatic get observedAttributes(): string[] {\n\t\treturn [\"src\", \"theme\", \"base\"];\n\t}\n\tprivate _resolver: Resolver | null = null\n\t;\n\tprivate _toolCaller: ToolCaller | null = null\n\t;\n\tprivate _css: CssInput | null = null\n\t;\n\tprivate _allowedOrigins: string[] = []\n\t;\n\tprivate _allowedRemote: ((url: string) => boolean) | null = null\n\t;\n\tprivate _data: unknown = null\n\t;\n\tprivate _layers: string[] | null = null\n\t;\n\tprivate _iframe: HTMLIFrameElement | null = null\n\t;\n\tprivate _loadToken = 0\n\t;\n\tprivate _boundMessageHandler = (event: MessageEvent) => this.handleMessage(event)\n\t;\n\tconstructor() {\n\t\tsuper();\n\t\tconst root = this.attachShadow({ mode: \"closed\" });\n\t\tconst style = document.createElement(\"style\");\n\t\tstyle.textContent = [\":host{display:block;height:100%;width:100%;}\", \"iframe{width:100%;height:100%;border:0;}\"].join(\"\\n\");\n\t\troot.appendChild(style);\n\t\tconst iframe = document.createElement(\"iframe\");\n\t\tiframe.setAttribute(\"sandbox\", \"allow-scripts\");\n\t\tiframe.setAttribute(\"referrerpolicy\", \"no-referrer\");\n\t\tiframe.style.width = \"100%\";\n\t\tiframe.style.height = \"100%\";\n\t\tiframe.style.border = \"0\";\n\t\tiframe.addEventListener(\"load\", () => this.sendDataUpdate());\n\t\troot.appendChild(iframe);\n\t\tthis._iframe = iframe;\n\t}\n\tconnectedCallback(): void {\n\t\twindow.addEventListener(\"message\", this._boundMessageHandler);\n\t\tthis.render();\n\t}\n\tdisconnectedCallback(): void {\n\t\twindow.removeEventListener(\"message\", this._boundMessageHandler);\n\t}\n\tattributeChangedCallback(name: string): void {\n\t\tif (name === \"src\" || name === \"theme\" || name === \"base\") {\n\t\t\tthis.render();\n\t\t}\n\t}\n\tget resolver(): Resolver | null {\n\t\treturn this._resolver;\n\t}\n\tset resolver(value: Resolver | null) {\n\t\tthis._resolver = value;\n\t\tthis.render();\n\t}\n\tget themeUrl(): string {\n\t\treturn this.getAttribute(\"theme\") || \"\";\n\t}\n\tget toolCaller(): ToolCaller | null {\n\t\treturn this._toolCaller;\n\t}\n\tset toolCaller(value: ToolCaller | null) {\n\t\tthis._toolCaller = value;\n\t}\n\tget base(): string {\n\t\treturn this.getAttribute(\"base\") || \"\";\n\t}\n\tset base(value: string) {\n\t\tif (value) {\n\t\t\tthis.setAttribute(\"base\", value);\n\t\t}\n\t\telse {\n\t\t\tthis.removeAttribute(\"base\");\n\t\t}\n\t}\n\tget src(): string {\n\t\treturn this.getAttribute(\"src\") || \"\";\n\t}\n\tset src(value: string) {\n\t\tif (value) {\n\t\t\tthis.setAttribute(\"src\", value);\n\t\t}\n\t\telse {\n\t\t\tthis.removeAttribute(\"src\");\n\t\t}\n\t}\n\tget allowedOrigins(): string[] {\n\t\treturn this._allowedOrigins;\n\t}\n\tset allowedOrigins(value: string[]) {\n\t\tthis._allowedOrigins = Array.isArray(value) ? value : [];\n\t}\n\tget allowedRemote(): ((url: string) => boolean) | null {\n\t\treturn this._allowedRemote;\n\t}\n\tset allowedRemote(value: ((url: string) => boolean) | null) {\n\t\tthis._allowedRemote = value;\n\t}\n\tget layers(): string[] | null {\n\t\treturn this._layers;\n\t}\n\tset layers(value: string[] | null) {\n\t\tthis._layers = Array.isArray(value) ? value : null;\n\t\tthis.render();\n\t}\n\tget css(): CssInput | null {\n\t\treturn this._css;\n\t}\n\tset css(value: CssInput | null) {\n\t\tthis._css = value;\n\t\tthis.render();\n\t}\n\tget data(): unknown {\n\t\treturn this._data;\n\t}\n\tset data(value: unknown) {\n\t\tthis._data = value;\n\t\tthis.sendDataUpdate();\n\t}\n\tprivate render(): void {\n\t\tif (!this.isConnected) return;\n\t\tconst uri = this.getRootUri();\n\t\tif (!uri) return;\n\t\tvoid this.load(uri);\n\t}\n\tprivate async load(uri: string): Promise<void> {\n\t\tconst token = ++this._loadToken;\n\t\tconst root = await this.resolveResource(uri, \"document\");\n\t\tif (!root.ok) return;\n\t\tconst html = new TextDecoder().decode(root.body);\n\t\tconst themeCss = buildThemeCss({ css: this._css, layers: this._layers });\n\t\tconst bootstrapScript = getIframeBootstrapScript(this._data);\n\t\tconst rewritten = rewriteHtml(\n\t\t\t{\n\t\t\t\thtml,\n\t\t\t\trootUri: uri,\n\t\t\t\tthemeCss,\n\t\t\t\tthemeLink: this.themeUrl || null,\n\t\t\t\tbootstrapScript,\n\t\t\t\tallowRemote: (url) => this.isRemoteAllowed(url)\n\t\t\t}\n\t\t);\n\t\tif (token !== this._loadToken) return;\n\t\tif (this._iframe) {\n\t\t\tthis._iframe.srcdoc = rewritten;\n\t\t}\n\t}\n\tprivate getRootUri(): string {\n\t\treturn this.getAttribute(\"src\") || \"\";\n\t}\n\tprivate handleMessage(event: MessageEvent): void {\n\t\tif (!this._iframe || event.source !== this._iframe.contentWindow) return;\n\t\tconst data = event.data;\n\t\tif (!data) return;\n\t\tif (data.type === \"mcp:request\") {\n\t\t\tconst uri = typeof data.uri === \"string\" ? data.uri : \"\";\n\t\t\tconst kind = (data.kind as ResourceKind) || \"document\";\n\t\t\tconst id = typeof data.id === \"number\" ? data.id : 0;\n\t\t\tif (!uri || !id) {\n\t\t\t\tconsole.error(\"[mcp] invalid request\", { uri, id, kind });\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst request: PendingRequest = {\n\t\t\t\tid,\n\t\t\t\turi,\n\t\t\t\tkind,\n\t\t\t\tsource: event.source\n\t\t\t};\n\t\t\tvoid this.fulfillRequest(request);\n\t\t\treturn;\n\t\t}\n\t\tif (data.type === \"mcp:tool-call\") {\n\t\t\tconst id = typeof data.id === \"number\" ? data.id : 0;\n\t\t\tconst params = data.params;\n\t\t\tconst method = typeof data.method === \"string\" ? data.method : \"tools/call\";\n\t\t\tif (!id) {\n\t\t\t\tconsole.error(\"[mcp] invalid tool call\", { id });\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (method !== \"tools/call\") {\n\t\t\t\tconsole.error(\"[mcp] unsupported tool method\", { method });\n\t\t\t\tconst message = {\n\t\t\t\t\ttype: \"mcp:tool-result\",\n\t\t\t\t\tid,\n\t\t\t\t\tok: false,\n\t\t\t\t\terror: `Unsupported tool method: ${method}`\n\t\t\t\t};\n\t\t\t\tthis.postMessageToSource(event.source, message, []);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst request: PendingToolCall = { id, params, source: event.source };\n\t\t\tvoid this.fulfillToolCall(request);\n\t\t}\n\t}\n\tprivate async fulfillRequest(request: PendingRequest): Promise<void> {\n\t\tlet response: ResolveResult;\n\t\ttry {\n\t\t\tresponse = await this.resolveResource(request.uri, request.kind);\n\t\t}\n\t\tcatch (error) {\n\t\t\tresponse = {\n\t\t\t\tok: false,\n\t\t\t\tmime: \"text/plain\",\n\t\t\t\tbody: new Uint8Array(),\n\t\t\t\terror: error instanceof Error ? error.message : \"Resolver error\"\n\t\t\t};\n\t\t}\n\t\tif (!response.ok) {\n\t\t\tconsole.error(\"[mcp] resolve failed\", { uri: request.uri, kind: request.kind, error: response.error || \"Unknown error\" });\n\t\t}\n\t\tconst body = response.body || new Uint8Array();\n\t\tconst buffer = body.buffer.slice(body.byteOffset, body.byteOffset + body.byteLength);\n\t\tconst message = {\n\t\t\ttype: \"mcp:response\",\n\t\t\tid: request.id,\n\t\t\tok: response.ok,\n\t\t\tmime: response.mime,\n\t\t\tbody: buffer,\n\t\t\terror: response.error\n\t\t};\n\t\tthis.postMessageToSource(request.source, message, [buffer]);\n\t}\n\tprivate async fulfillToolCall(request: PendingToolCall): Promise<void> {\n\t\tlet response: ToolResult;\n\t\tconst caller = this._toolCaller;\n\t\tif (!caller) {\n\t\t\tresponse = { ok: false, error: \"No tool caller\" };\n\t\t}\n\t\telse {\n\t\t\ttry {\n\t\t\t\tconst result = await caller(request.params);\n\t\t\t\tresponse = { ok: true, result };\n\t\t\t}\n\t\t\tcatch (error) {\n\t\t\t\tresponse = { ok: false, error: error instanceof Error ? error.message : \"Tool call failed\" };\n\t\t\t}\n\t\t}\n\t\tif (!response.ok) {\n\t\t\tconsole.error(\"[mcp] tool call failed\", { error: response.error || \"Unknown error\" });\n\t\t}\n\t\tconst message = {\n\t\t\ttype: \"mcp:tool-result\",\n\t\t\tid: request.id,\n\t\t\tok: response.ok,\n\t\t\tresult: response.result,\n\t\t\terror: response.error\n\t\t};\n\t\tthis.postMessageToSource(request.source, message, []);\n\t}\n\tprivate async resolveResource(uri: string, kind: ResourceKind): Promise<ResolveResult> {\n\t\tif (uri.startsWith(\"ui://\")) {\n\t\t\tconst resolver = this.getActiveResolver();\n\t\t\tif (!resolver) {\n\t\t\t\treturn {\n\t\t\t\t\tok: false,\n\t\t\t\t\tmime: \"text/plain\",\n\t\t\t\t\tbody: new Uint8Array(),\n\t\t\t\t\terror: \"No resolver\"\n\t\t\t\t};\n\t\t\t}\n\t\t\tconst result = await normalizeResolverResult(await resolver(uri), kind, uri);\n\t\t\treturn result;\n\t\t}\n\t\tif (uri.startsWith(\"http://\") || uri.startsWith(\"https://\")) {\n\t\t\tif (!this.isRemoteAllowed(uri)) {\n\t\t\t\treturn {\n\t\t\t\t\tok: false,\n\t\t\t\t\tmime: \"text/plain\",\n\t\t\t\t\tbody: new Uint8Array(),\n\t\t\t\t\terror: \"Remote blocked\"\n\t\t\t\t};\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(uri);\n\t\t\t\tconst normalized = await normalizeResolverResult(res, kind, uri);\n\t\t\t\treturn normalized;\n\t\t\t}\n\t\t\tcatch (error) {\n\t\t\t\treturn {\n\t\t\t\t\tok: false,\n\t\t\t\t\tmime: \"text/plain\",\n\t\t\t\t\tbody: new Uint8Array(),\n\t\t\t\t\terror: error instanceof Error ? error.message : \"Remote fetch failed\"\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tok: false,\n\t\t\tmime: inferMime(kind, uri),\n\t\t\tbody: new Uint8Array(),\n\t\t\terror: \"Unsupported URI\"\n\t\t};\n\t}\n\tprivate isRemoteAllowed(url: string): boolean {\n\t\tif (this._allowedRemote) {\n\t\t\treturn this._allowedRemote(url);\n\t\t}\n\t\tif (!this._allowedOrigins.length) return false;\n\t\ttry {\n\t\t\tconst parsed = new URL(url);\n\t\t\treturn this._allowedOrigins\n\t\t\t\t.some(\n\t\t\t\t\t(origin) => {\n\t\t\t\t\t\tif (origin.includes(\"://\")) {\n\t\t\t\t\t\t\treturn parsed.origin === origin;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn parsed.hostname === origin;\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t}\n\t\tcatch {\n\t\t\treturn false;\n\t\t}\n\t}\n\tprivate postMessageToSource(source: MessageEventSource | null, message: unknown, transfer: Transferable[] = []): void {\n\t\tif (!source) {\n\t\t\tconsole.error(\"[mcp] missing message source\", message);\n\t\t\treturn;\n\t\t}\n\t\tconst postMessage = (source as { postMessage?: unknown }).postMessage;\n\t\tif (typeof postMessage !== \"function\") {\n\t\t\tconsole.error(\"[mcp] invalid message source\", source);\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\t(source as Window).postMessage(message, \"*\", transfer);\n\t\t\treturn;\n\t\t}\n\t\tcatch (error) {\n\t\t\ttry {\n\t\t\t\t(source as MessagePort).postMessage(message, transfer);\n\t\t\t}\n\t\t\tcatch (fallbackError) {\n\t\t\t\tconsole.error(\"[mcp] postMessage failed\", { error, fallbackError });\n\t\t\t}\n\t\t}\n\t}\n\tprivate sendDataUpdate(): void {\n\t\tif (!this._iframe || !this._iframe.contentWindow) return;\n\t\tthis._iframe.contentWindow.postMessage({ type: \"mcp-data:update\", payload: this._data }, \"*\");\n\t}\n\tprivate getActiveResolver(): Resolver | null {\n\t\tif (this._resolver) return this._resolver;\n\t\tconst base = this.base || DEFAULT_BASE;\n\t\treturn this.buildDefaultResolver(base);\n\t}\n\tprivate buildDefaultResolver(base: string): Resolver {\n\t\tconst resolvedBase = resolveBaseUrl(base);\n\t\treturn async(uri) => {\n\t\t\tconst url = buildResolverUrl(resolvedBase, uri);\n\t\t\treturn fetch(url);\n\t\t};\n\t}\n}\nconst DEFAULT_BASE = \"/mcp/resources/\";\nfunction resolveBaseUrl(base: string): string {\n\tif (!base) return base;\n\tif (typeof window === \"undefined\" || !window.location) return base;\n\ttry {\n\t\treturn new URL(base, window.location.href).toString();\n\t}\n\tcatch {\n\t\treturn base;\n\t}\n}\nfunction buildResolverUrl(base: string, uri: string): string {\n\tconst path = stripUiScheme(uri);\n\tif (base.includes(\"{path}\")) {\n\t\treturn base.split(\"{path}\").join(encodeURI(path));\n\t}\n\tif (base.includes(\"{uri}\")) {\n\t\treturn base.split(\"{uri}\").join(encodeURIComponent(uri));\n\t}\n\tif (base.includes(\"?\")) {\n\t\treturn `${base}&uri=${encodeURIComponent(uri)}`;\n\t}\n\tif (base.endsWith(\"/\")) {\n\t\treturn `${base}${encodeURI(path)}`;\n\t}\n\treturn `${base}/${encodeURI(path)}`;\n}\nfunction stripUiScheme(uri: string): string {\n\tif (!uri.startsWith(\"ui://\")) return uri;\n\treturn uri.slice(\"ui://\".length);\n}\nexport function defineMcpView(): void {\n\tif (!customElements.get(\"mcp-view\")) {\n\t\tcustomElements.define(\"mcp-view\", McpViewElement);\n\t}\n}\n"],
  "mappings": "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",
  "names": ["src_exports", "__export", "McpViewElement", "defineMcpView", "normalizeResolverResult", "result", "kind", "uri", "body", "inferMime", "error", "ext", "getExtension", "lookup", "last", "getIframeBootstrapScript", "initialData", "safeSerialize", "safeSerialize", "value", "BLOCKED_ATTR", "rewriteHtml", "options", "doc", "addRootClass", "rewriteElement", "head", "ensureHead", "themeStyle", "bootstrapAnchor", "linkNode", "buildThemeLink", "bootstrap", "tagName", "attrName", "replacementTag", "elements", "el", "raw", "info", "resolveUrl", "replacement", "copyAttributes", "base", "value", "schemeMatch", "scheme", "isIgnoredScheme", "resolved", "from", "to", "attr", "className", "existing", "classes", "html", "url", "trimmed", "resolveUrlWithWindow", "node", "DEFAULT_LAYERS", "defaultVariables", "utilityCss", "serializeVariables", "buildThemeCss", "inputs", "parts", "order", "buildLayerOrder", "wrapLayer", "overrides", "normalizeCssInput", "layers", "layer", "trimmed", "i", "name", "css", "vars", "key", "value", "input", "filtered", "filterVariables", "McpViewElement", "event", "root", "style", "iframe", "name", "value", "uri", "token", "html", "themeCss", "buildThemeCss", "bootstrapScript", "getIframeBootstrapScript", "rewritten", "rewriteHtml", "url", "data", "kind", "id", "request", "params", "method", "message", "response", "error", "body", "buffer", "caller", "resolver", "normalizeResolverResult", "res", "inferMime", "parsed", "origin", "source", "transfer", "fallbackError", "base", "DEFAULT_BASE", "resolvedBase", "resolveBaseUrl", "buildResolverUrl", "path", "stripUiScheme", "defineMcpView", "defineMcpView"]
}
